<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport"
				content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Document</title>
</head>
<body>
<script>
  //Исключение – это сигнал о возникновении исключительной ситуации (иначе говоря ошибки) во время выполнения кода. При возникновении ошибки сценарий прекращает свою работу, а в консоль браузера выводится сообщение об ошибке:
  alert(x);   // Ошибка. Используется неопределённая переменная

  //Сообщения об ошибках помогают нам улучшать код, они позволяют сообщать пользователям наших проектов о том, что что-то пошло не так, и, возможно, рассказывают пользователям о том, как нужно вести себя для того, чтобы ошибок больше не возникало.

  //Инструкция throw позволяет явно сгенерировать исключение.
  //Потом брошенное исключение можно поймать с помощью try
  throw new Error('something went wrong'); //выброшено исключение с этим объектом.
  //выполнение скрипта остановится в том случае, если не были предприняты меры по обработке ошибки.

  //Начинающие JS-программисты обычно не используют инструкцию throw. Они, как правило, сталкиваются с исключениями, выдаваемыми либо средой выполнения языка, либо сторонними библиотеками. Когда это происходит — в консоль попадает нечто вроде ReferenceError: fs is not defined и выполнение программы останавливается.


  //У экземпляров объекта Error есть несколько свойств:
  //1. message - сюда попадает та строка, которую можно передать конструктору ошибки в качестве аргумента
  const myError = new Error('please improve your code');
  console.log(myError.message); // please improve your code

  /* 2. stack - можно просмотреть стек вызовов (историю ошибки), который показывает последовательность операций, приведшую к неправильной работе программы. В частности, это позволяет понять — в каком именно файле содержится сбойный код, и увидеть, какая последовательность вызовов функций привела к ошибке.
	
	Error: please improve your code
	 at Object.<anonymous> (/Users/gisderdube/Documents/_projects/hacking.nosync/error-handling/src/general.js:1:79)
	 at Module._compile (internal/modules/cjs/loader.js:689:30)
	 at Object.Module._extensions..js (internal/modules/cjs/loader.js:700:10)
	 at Module.load (internal/modules/cjs/loader.js:599:32)
	 at tryModuleLoad (internal/modules/cjs/loader.js:538:12)
	 at Function.Module._load (internal/modules/cjs/loader.js:530:3)
	 at Function.Module.runMain (internal/modules/cjs/loader.js:742:12)
	 at startup (internal/bootstrap/node.js:266:19)
	 at bootstrapNodeJSCore (internal/bootstrap/node.js:596:3)
	*/
  try {
    throw new Error('something went wrong');
  } catch (e) {
    console.log(e)
    console.log(e.message)
    console.log(e.stack)
  }

  /********************/

  //try...catch - самый простой способ обработки ошибок, любых ошибок, происходящих в синхронном коде.
  const a = 5;

  try {
    console.log(b) // переменная b не объявлена - возникает ошибка
  } catch (err) {
    console.error(err) // в консоль попадает сообщение об ошибке и стек ошибки
  }

  console.log(a); // выполнение скрипта не останавливается, данная команда выполняется
  //Если бы в этом примере мы не заключили бы сбойную команду console.log(b) в блок try...catch, то выполнение скрипта было бы остановлено.

  /********************/

  try {
    console.log(b) // переменная b не объявлена - возникает ошибка
  } catch (err) {
    console.error(err) // в консоль попадает сообщение об ошибке и стек ошибки
  } finally { // выполнит независимо от того, произошла ошибка или нет.
    console.log(a) // этот код будет выполнен в любом случае
  }

  /********************/

  //Кстати, бросать исключение можно и внутри catch, тогда оно перейдет к следующему catch - это называется проброс исключений.
  function doThat() {
    try {
      a();
    } catch(e) {
      if(e instanceof TypeError) { // Если выброшено исключение TypeError, то
        alert("TypeError!"); // написать TypeError!
      } else { // Иначе
        throw e; // doThat() не знает, как обрабатывать другие типы исключений, передаем дальше
      }
    }
  }
  // ...
  try {
    doThat(); // Если a() выбросит TypeError, catch в doThat() его обработает
  } catch(e) { // doThat() пробросил исключение дальше
    alert("Some other error!");
  }


  //Сначала он пытается выполнить все инструкции (операторы), указанные в блоке try. Если внутри блока try ошибки не возникает, то блок catch просто игнорируется, т.е. он не выполняется. В том случае если внутри блока try возникает ошибка, то оставшиеся операторы в этом блоке будут проигнорированы (т.е. они выполняться не будут) и сразу же начнут выполняться операторы внутри блока catch. Самое главное то, что инструкции, идущие после оператора try...catch, продолжат выполняться и работа программы не остановится.

  //Если в JSON.parse подать невалидный JSON, то он выкинет исключение. Вот тут-то и понадобится try..catch.
  //там где мы не можем быть полностью уверены в том, что все будет ок в данном участке кода

</script>
</body>
</html>